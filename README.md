ArduinoMyLog3
=============

## Project ArduinoMyLog3 - (ETHEREUM based)

This project will store into an Ethereum based Blockchain, the data of temperature provided by Arduino.

## Quick links and licensing references

- [Ethereum is a network of computers all over the world that follow a set of rules called the Ethereum protocol](https://ethereum.org)
- [Hardhat is an Ethereum development environment for professionals](https://hardhat.org)
- [Arduino is an open-source electronics platform](https://www.arduino.cc)
- [TMP36 library is a very simple Arduino library](https://github.com/Isaacr100/TMP36)

## Tested for

* ARDUINO UNO BOARD with ARDUINO ETHERNET SHIELD (https://store.arduino.cc) equipped with temperature sensor TMP36 (Note: any devices that provides data in json format could be included in this project)


## Notice
This software is experimental and a work in progress. Data inserted into blockchain will be accessible to anyone.
Under no circumstances should these files be used in relation to any critical system(s).
Use of these files is at your own risk.
THE SOFTWARE IS PROVIDED "AS IS". See license file LICENSE.md for details.

## Quick start

* We assume that we are using Ethereum Holesky Testnet and that arduinomylog.ino file has been uploaded correctly into Arduino and that by calling the Arduino IP into a browser, we obtain a json similar to this:
```json
{"WeatherStation": [{"location": "Trento - Italy","temperature celsius": "20.31","temperature fahrenheit": "68.56"}]}
```
* Now we have to choose a blockchain, on which storing the temperature and humidity data retrieved from the sensor based on the JSON generated by Arduino. For this example is used the TESTNET version of ETHEREUM HOLESKY BLOCKCHAIN ( https://holesky.etherscan.io ); if you are not familiar with how a blockchain works, it is recommended to read more information here: [https://ethereum.org/guides](https://ethereum.org/guides). For this example EOA "0xa67a79cf9ead85879e2d15238707afc0a2f45eaa" is used on ETHEREUM HOLESKY TESTNET.

* Create the folders and verify Hardhat configuration ( more info https://hardhat.org ):

mkdir -p ~/Projects/box && cd ~/Projects/box

* initize HardHat Project by creating an empty hardhat.config.js on Holesky Testnet and verify the dependencies:

cat hardhat.config.js

```javascript
require("dotenv").config();
require("@nomiclabs/hardhat-ethers");
const { API_URL, PRIVATE_KEY } = process.env;
module.exports = {
  defaultNetwork: "holesky",
  networks: {
    hardhat: {
    },
    holesky: {
      url: API_URL,
      accounts: [`0x${PRIVATE_KEY}`]
    }
  },
  solidity: {
    version: "0.8.22"
    }
  };
```
* verify dependencies:

cat package.json 

```json
...
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@nomiclabs/hardhat-ethers": "^2.2.3",
    "@nomiclabs/hardhat-waffle": "^2.0.6",
    "chai": "^4.3.10",
    "ethereum-waffle": "^4.0.10",
    "ethers": "^5.7.2",
    "hardhat": "^2.19.1"
  },
  "dependencies": {
    "@nomiclabs/hardhat-etherscan": "^3.1.7",
    "@openzeppelin/contracts": "^5.0.0",
    "axios": "^1.6.2",
    "dotenv": "^16.3.1"
  }
....
```

* Add project folders

mkdir ~/Projects/box/contracts ~/Projects/box/scripts

* Check the solidity file:

cat ~/Projects/box/contracts/box.sol

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.22;
import "@openzeppelin/contracts/access/Ownable.sol";
contract Box is Ownable {
   constructor() Ownable(msg.sender) {}
   uint256 private _value;
   event ValueChanged(uint256 value);
   function store(uint256 value) public onlyOwner {
        _value = value;
        emit ValueChanged(value);
    }
    function retrieve() public view returns (uint256) {
        return _value;
    }
}
```

* Verify your Execution Layer:

```shell
curl -sX POST \
http://[RPC_ENDPOINT_HERE:PORT_HERE] \
-H "Content-Type: application/json" \
-d '{"method":"eth_chainId","params":[],"id":1,"jsonrpc":"2.0"}' | json_pp
```

* Verify that is Holesky Testnet:

```shell
echo $((16#4268))
```
* if you do not have a running Execution Layer node, just use one from the following list:

https://chainlist.org/chain/17000

* Check .env file

cat ~/Projects/box/.env

```shell
API_URL="http://[EXECUTION_LAYER_HERE:PORT_HERE]"
PUBLIC_KEY="[YOUR_PUBLIC_ADDRESS_HERE]"
PRIVATE_KEY="[YOUR_PRIVATE_KEY_HERE]"
```

* Compile the smart contract:

npx hardhat compile

OUTPUT:

Compiled 1 Solidity file successfully (evm target: paris).

* Verify the script to deploy the smart contract into Holesky Blockchain:

cat ~/Projects/box/scripts/deploy.js

```javascript
async function main () {
  const Box = await ethers.getContractFactory('Box');
  console.log('Deploying Box...');
  const box = await Box.deploy(); 
  await box.deployed(address initialOwner);
  console.log('Box deployed to:', box.address);
}
main()
  .then(() => process.exit(0))
  .catch(error => {
    console.error(error);
    process.exit(1);
  });
```

* Deploy the smart contract into Holesky Testnet:

```shell
npx hardhat --network holesky run scripts/deploy.js
```
OUTPUT:

Deploying Box...
Box deployed to: 0x9247D54ab2A5B6Ad46ee0f911CEDFCe4f01aAF01

.... the smart contract is now on the Ethereum (testnet) HOLESKY chain!
In this case:
https://holesky.etherscan.io/address/0x9247D54ab2A5B6Ad46ee0f911CEDFCe4f01aAF01

Optional: if you make the smart contract verified, then anyone can interact with it directly from Etherscan.
For example have a look at:
https://holesky.etherscan.io/address/0x9247D54ab2A5B6Ad46ee0f911CEDFCe4f01aAF01#readContract
then click under function "retrieve" and the output will be latest temperature value like:
2030 uint256   -----> 20.30 Â°C

* Retrieve Arduino json Data:

cat ~/Projects/box/scripts/get_json.js

```javascript
const axios = require('axios');
const url = 'http://[ARDUINO_WEBSERVER_HERE]';
axios.get(url)
  .then(response => {
    const jsonData = response.data;
    const weatherStation = jsonData.WeatherStation[0];
    console.log('Location:', weatherStation.location);
    console.log('Temperature Celsius:', weatherStation['temperature celsius']);
    console.log('Temperature Fahrenheit:', weatherStation['temperature fahrenheit']);
  })
  .catch(error => {
    console.error('Errore during HTTP request:', error.message);
  });
```

* Verify data:

node ~/Projects/box/scripts/get_json.js

OUTPUT:

Location: Trento - Italy
Temperature Celsius: 20.31
Temperature Fahrenheit: 68.56

* Check the script that will store json data into Holesky Blockchain:

cat ~/Projects/box/scripts/store_json.js

```javascript
const axios = require('axios');
const url = 'http://[ARDUINO_WEBSERVER_HERE]';
axios.get(url)
  .then(async response => {
    const jsonData = response.data;
    const weatherStation = jsonData.WeatherStation[0];
   if (weatherStation && 'temperature celsius' in weatherStation) {
   const temperatureCelsius = parseInt(parseFloat(weatherStation['temperature celsius']) * 100);
   await main(temperatureCelsius);
  }
  else {
  console.error('Dato non valido.');
  process.exit(1);
       }
    } 
  );
  async function main(temperatureCelsius) {
  console.log('Temperature retrieved from JSON:', temperatureCelsius);
  const address = '[YOUR_SMART_CONTRACT_ADDRESS_HERE]';
  const Box = await ethers.getContractFactory('Box');
  const box = await Box.attach(address);
  let tx;
  tx = await box.store(temperatureCelsius);
  await tx.wait();
  const value = await box.retrieve();
  console.log('Temperature stored into blockchain:', value.toString());
};
```

## Usage

Store the json data into Holesky Testnet:

npx hardhat run --network holesky ~/Projects/box/scripts/store_json.js

OUTPUT:

Temperature retrieved from JSON: 2155
Temperature stored into blockchain: 2155

## Monitor

See your data on blockchain (they are accessible to anyone) by visiting a blockchain explorer; in this case:

https://holesky.etherscan.io/address/0x9247D54ab2A5B6Ad46ee0f911CEDFCe4f01aAF01


## Optional

Insert the script into crontab to have the temperature data into blockchain. Note that Ethereum Holesky is a testnet but other blockchains could cost money for transactions.
